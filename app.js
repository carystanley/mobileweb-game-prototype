!function(t){function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}var e={};i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=39)}([function(t,i,e){function s(t,i){this.frame=i.frame,this.x=i.x,this.y=i.y,this.velocityX=0,this.velocityY=0,this.width=14,this.height=8,this.world=t,this.sprite=i.sprite,this.frame=4,this.animation=new o(n)}var o=e(32),n={up:{frames:[0,1],delay:12,loop:!0},right:{frames:[2,3],delay:6,loop:!0},down:{frames:[4,5],delay:12,loop:!0},left:{frames:[6,7],delay:6,loop:!0}};s.prototype.step=function(t,i){var e=null;this.prevX=this.x,this.prevY=this.y,this.submove(t,0),this.submove(0,i),this.x=Math.min(this.x,this.world.width),this.x=Math.max(this.x,0),this.y=Math.min(this.y,this.world.height),this.y=Math.max(this.y,0),t>0?e="right":t<0&&(e="left"),i>0?e="down":i<0&&(e="up"),e?(this.animation.getCurrentAnimation()!==e&&this.animation.play(e),this.animation.update()):this.animation.stop(),this.frame=this.animation.getCurrentFrame()},s.prototype.submove=function(t,i){var e=!1,s=this.x,o=this.y,n=this.width/2,r=this.height/2,h=this.world.map,a=s+t-n,c=o+i-r,p=s+t+n,u=o+i+r;return i>0&&(h.collide(a,u)?e=!0:h.collide(p,u)&&(e=!0)),i<0&&(h.collide(a,c)?e=!0:h.collide(p,c)&&(e=!0)),t>0&&(h.collide(p,c)?e=!0:h.collide(p,u)&&(e=!0)),t<0&&(h.collide(a,c)?e=!0:h.collide(a,u)&&(e=!0)),e?(t<0&&(this.x=16*((s-n)/16|0)+n),t>0&&(this.x=16*((s+n)/16+1|0)-n-1),i<0&&(this.y=16*((o-r)/16|0)+r),i>0&&(this.y=16*((o+r)/16+1|0)-r-1),!1):(this.x+=t,this.y+=i,!0)},t.exports=s},function(t,i){function e(t,i,e,s,o,n,r,h){this.font=t,this.x=i,this.y=e,this.winMargin=n,this.width=s,this.lineHeight=t.data.lineHeight,this.rowHeight=o,this.itemOffset=Math.max(Math.floor((this.rowHeight-this.lineHeight)/2),0),this.setOptions(r),this.choiceHandler=h,this.selected=null,this.visible=!0}e.prototype.setOptions=function(t){this.options=t||[]},e.prototype.draw=function(t){if(this.visible){var i=this.options,e=i.length,s=this.rowHeight,o=this.winMargin,n=this.itemOffset;t.fillStyle="black",t.fillRect(this.x-o,this.y-o,this.width+2*o,e*s+2*o);for(var r=this.x,h=this.y,a=this.font,c=0;c<e;c++)a.drawText(t,i[c].text,r+n,h+n),h+=s;null!==this.selected&&(t.fillStyle="rgba(170, 170, 170, 0.5)",t.fillRect(this.x,this.y+this.selected*s,this.width,s))}},e.prototype.event=function(t,i,e){if(this.visible){var s=i-this.x,o=e-this.y,n=this.rowHeight,r=this.options.length*n;if(s>0&&o>0&&s<this.width&&o<r){var h=Math.floor(o/n);switch(t){case"click":this.choiceHandler(this.options[h]),this.selected=null;break;case"down":this.selected=h}return!0}return!1}},e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},t.exports=e},function(t,i){var e={collision:function(t,i,e){var s=t.width/2,o=t.height/2,n=i.width/2,r=i.height/2,h=t.x,a=t.y,c=i.x,p=i.y,u=c-h,l=p-a,f=Math.abs(u)-s-n,d=Math.abs(l)-o-r;f<0&&d<0&&e(t,i,u,l,f,d)},pointInRect:function(t,i,e,s,o,n){return t>=e&&t<=e+o&&i>=s&&i<=s+n}};t.exports=e},function(t,i){function e(t,i,e){return new Function("module",'with(module){return(function(global,window,document){"use strict";return eval("'+t+'");})(this,this,this)}').call(e,i)}t.exports=e},function(t,i){function e(t,i){var e=this;this.game=t,Object.keys(i).forEach(function(t){e[t]=i[t]})}e.prototype.switch=function(t,i){var e=this.currentState;e&&e.exit&&e.exit();var s=this[t];s&&!s.initied&&s.init&&(s.init(),s.initied=!0),this.currentState=s,s&&s.enter&&s.enter(i)},e.prototype.update=function(){var t=this.currentState;t&&t.update&&t.update()},e.prototype.draw=function(t,i){var e=this.currentState;e&&e.update&&e.draw(t,i)},e.prototype.event=function(t,i,e){var s=this.currentState;s&&s.event&&s.event(t,i,e)},t.exports=e},function(t,i,e){var s=e(10),o=e(4),n=e(30),r=e(26),h=e(25),a=e(23),c=e(24),p=e(22),u=e(27),l={};l.setup=function(t,i,e){function l(){var t=document.documentElement.clientWidth,i=document.documentElement.clientHeight,e=g.width,s=g.height,o=Math.round(t/e),n=Math.round(i/s),r=Math.min(o,n);g.style.width=e*r+"px",g.style.height=s*r+"px"}function f(t,i,e){var s=Math.floor(i*(g.width/g.offsetWidth)),o=Math.floor(e*(g.height/g.offsetHeight));v.state.event(t,s,o)}function d(t,e){var s=e.changedTouches[0],o=g.getBoundingClientRect(),n=document.documentElement,r=o.top+i.pageYOffset-n.clientTop,h=o.left+i.pageXOffset-n.clientLeft;f(t,s.pageX-h,s.pageY-r)}function y(){m.clearRect(0,0,g.width,g.height),v.state.update(),v.state.draw(m,v.resources),i.requestAnimationFrame(y)}var g=document.getElementById(t),m=g.getContext("2d"),v={};v.config=e,v.getWidth=function(){return g.width},v.getHeight=function(){return g.height},v.data=new s(v),v.layout=new n(v);var w=function(t){return t.preventDefault(),i.scroll(0,0),!1};i.document.addEventListener("touchmove",w,!1);var b,x={click:"click",mouseup:"up",mousedown:"down"};for(b in x)Object.prototype.hasOwnProperty.call(x,b)&&function(t){g.addEventListener(t,function(i){f(x[t],i.offsetX,i.offsetY)},!1)}(b);var M={touchmove:"move",touchend:"up",touchstart:"down"};for(b in M)Object.prototype.hasOwnProperty.call(M,b)&&function(t){g.addEventListener(t,function(i){d(M[t],i)},!0)}(b);l(),i.addEventListener("resize",l),v.ctx=m,v.resources={},v.state=new o(v,{explore:new r(v),exploreMenu:new h(v),cutscene:new a(v),battle:new p(v),loading:new u(v),enterBattle:new c(v)}),v.state.switch("loading"),y()},window.Game=l,t.exports=l},function(t,i){t.exports={height:6,layers:[{data:[1,3,3,4,5,6,3,3,3,3,3,3,3,4,5,6,3,3,3,3,3,3,3,4,5,6,3,3,3,3,3,3,3,4,5,6,3,3,3,3,2,1,3,3,34,35,36,3,3,3,3,3,3,3,34,35,36,3,3,3,3,3,3,3,34,35,36,3,3,3,3,3,3,3,34,35,36,3,3,3,3,2,1,63,63,64,65,66,63,63,63,63,63,63,63,64,65,66,63,63,63,63,63,63,63,64,65,66,63,63,63,63,63,63,63,64,65,66,63,63,63,63,2,31,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,32,61,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,62,91,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,94,93,92],height:6,name:"layer0",opacity:1,type:"tilelayer",visible:!0,width:41,x:0,y:0},{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,630,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,643,0,0,0,655,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,654,0,0,0,0,0,0,0,0,0,0,0,0,0,655,0,0,0,0,0,0,656,0,0,0,668,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,667,0,0,0,0,0,0,0,0,0,0,0,0,0,668,0,0,0,0,0,0,669,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:6,name:"layer1",opacity:1,type:"tilelayer",visible:!0,width:41,x:0,y:0},{data:[757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,757,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,757,0,0,0,0,0,0,0,0,0,0,0,0,0,757,0,0,0,0,0,0,0,0,757,757,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,757,757,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,757],height:6,name:"collision",opacity:.439999997615814,type:"tilelayer",visible:!0,width:41,x:0,y:0},{draworder:"topdown",name:"locations",objects:[{height:16,id:14,name:"start",rotation:0,type:"",visible:!0,width:16,x:48,y:64}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",name:"spawns",objects:[{height:16,id:16,name:"basic1",rotation:0,type:"basic",visible:!0,width:16,x:384,y:64},{height:16,id:17,name:"basic2",rotation:0,type:"basic",visible:!0,width:16,x:608,y:64},{height:16,id:19,name:"basic3",properties:{probability:50},propertytypes:{probability:"int"},rotation:0,type:"basic",visible:!0,width:16,x:464,y:80},{height:16,id:20,name:"basic4",properties:{probability:50},propertytypes:{probability:"int"},rotation:0,type:"basic",visible:!0,width:16,x:192,y:80},{height:16,id:21,name:"basic5",properties:{probability:50},propertytypes:{probability:"int"},rotation:0,type:"basic",visible:!0,width:16,x:192,y:48},{height:16,id:22,name:"basic6",properties:{probability:100},propertytypes:{probability:"int"},rotation:0,type:"basic",visible:!0,width:16,x:96,y:80}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{draworder:"topdown",name:"events",objects:[{height:16,id:2,name:"snatch",properties:{eventId:1},propertytypes:{eventId:"int"},rotation:0,type:"",visible:!0,width:16,x:160,y:48},{height:16,id:4,name:"banana_guru",rotation:0,type:"",visible:!0,width:16,x:304,y:80},{height:16,id:5,name:"ouch",rotation:0,type:"",visible:!0,width:16,x:432,y:48},{height:16,id:6,name:"bully_join",rotation:0,type:"",visible:!0,width:16,x:336,y:48},{height:8,id:7,name:"door",properties:{location:"hall_from_bedroom",map:"map_house"},propertytypes:{location:"string",map:"string"},rotation:0,type:"transport",visible:!0,width:16,x:544,y:43},{height:16,id:23,name:"robot",rotation:0,type:"",visible:!0,width:16,x:16,y:64},{height:48,id:25,name:"alert",rotation:0,type:"",visible:!0,width:16,x:96,y:48}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextobjectid:26,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.0.3",tileheight:16,tilesets:[{columns:30,firstgid:1,image:"../images/layer0.png",imageheight:320,imagewidth:480,margin:0,name:"layer0",spacing:0,tilecount:600,tileheight:16,tilewidth:16},{columns:13,firstgid:601,image:"../images/layer1.png",imageheight:192,imagewidth:208,margin:0,name:"layer1",spacing:0,tilecount:156,tileheight:16,tilewidth:16},{columns:1,firstgid:757,image:"../images/collision.png",imageheight:16,imagewidth:16,margin:0,name:"collision",spacing:0,tilecount:1,tileheight:16,tilewidth:16,transparentcolor:"#ff00ff"}],tilewidth:16,type:"map",version:1,width:41}},function(t,i,e){function s(t){this.game=t}var o=e(35),n=o.transition;s.prototype.setup=function(t){this.addPlayerCharacters(),this.addEnemies(t),this.turnOrder=[].concat(this.pcs,this.enemies),this.cursor=0},s.prototype.addPlayerCharacters=function(){var t=[],i=this.game;i.data.party.forEach(function(e){var s=i.data.members[e]||{};t.push({sprite:s.sprite,name:s.name,hp:10,rollhp:10,offset:0})}),this.pcs=t},s.prototype.addEnemies=function(t){var i=[],e=this.game;t.forEach(function(t){var s=e.config.enemies[t.type]||{};i.push({hp:s.hp})}),this.enemies=i},s.prototype.getPlayerCharacters=function(){return this.pcs},s.prototype.getEnemies=function(){return this.enemies},s.prototype.tick=function(){var t=this.cursor;this.pcs.forEach(function(i,e){i.rollhp=n(i.rollhp,i.hp,1/16),i.offset=t===e?n(i.offset,20,.5):n(i.offset,0,.5)})},s.prototype.startRound=function(){this.turnOrder.forEach(function(t){t.action=void 0}),this.cursor=0},s.prototype.setChoice=function(t){this.pcs[this.cursor].choice=t,this.cursor++},s.prototype.setEnemyChoices=function(t){this.enemies.forEach(function(t,i){t.choice="bash"})},s.prototype.allChoosen=function(){return this.cursor>=this.pcs.length},s.prototype.isWon=function(){this.enemies.every(function(t){return t.isDead()})},s.prototype.isLost=function(){this.pcs.every(function(t){return t.isDead()})},t.exports=s},function(t,i){function e(t,i,e,s){e=e||0,s=s||0,this.sheet=i;var o={font:t.font.info._face,size:parseInt(t.font.info._size,10),lineHeight:parseInt(t.font.common._lineHeight,10)+s,chars:{}};t.font.chars.char.forEach(function(t){var i=parseInt(t._id,10);o.chars[i]={x:parseInt(t._x,10),y:parseInt(t._y,10),width:parseInt(t._width,10),height:parseInt(t._height,10),xOffset:parseInt(t._xoffset,10),yOffset:parseInt(t._yoffset,10),xAdvance:parseInt(t._xadvance,10)+e,kerning:{}}}),t.font.kernings&&t.font.kernings.kerning&&t.font.kernings.kerning.forEach(function(t){o.chars[t._second].kerning[t._first]=parseInt(t._amount,10)}),this.data=o}e.prototype.drawText=function(t,i,e,s){var o,n,r=this.data.chars,h=this.sheet;for(o=0;o<i.length;o++)n=r[i.charCodeAt(o)],t.drawImage(h,n.x,n.y,n.width,n.height,e+n.xOffset,s+n.yOffset,n.width,n.height),e+=n.xAdvance},e.prototype.measureText=function(t){var i,e,s=this.data.chars,o=0;for(i=0;i<t.length;i++)e=s[t.charCodeAt(i)],o+=e.xAdvance;return o},t.exports=e},function(t,i){var e={transport:function(t,i,e){t.game.state.explore.mapTransport(i.map,i.location),e()},dialog:function(t,i,e){t.dialog.showText(i.text,e)},fadeOut:function(t,i,e){t.matte.fadeOut(i.ticks,e)},fadeIn:function(t,i,e){t.matte.fadeIn(i.ticks,e)},addItemToInventory:function(t,i,e){t.game.data.inventory.add(i.id);var s=t.game.config.items[i.id];t.dialog.showText("You got "+s.label+"!",e)},removeItemFromInventory:function(t,i,e){t.game.player.data.removeById(i.id),e()},setFlag:function(t,i,e){t.game.data.setFlag(i.id,i.value),t.game.state.explore.world.refresh(),e()},joinParty:function(t,i,e){t.game.data.joinParty(i.id),t.game.state.explore.refreshParty(),e()}};t.exports=e},function(t,i,e){function s(t){this.init(),this.game=t}var o=e(17);s.prototype.init=function(){this.inventory=new o(8),this.party=["hero","girl"],this.members={hero:{sprite:0,name:"Izumi"},girl:{sprite:1,name:"Asami"},bully:{sprite:2,name:"Ryoko"}},this.flags={},this.inventory.add("sneaker")},s.prototype.getGoodsMenu=function(){for(var t=this.game,i=[],e=this.inventory.getItems(),s=e.length,o=0;o<s;o++){var n=e[o],r=t.config.items[n];i.push({id:n,text:r.label})}return i},s.prototype.hasInventoryItem=function(t){return this.inventory.contains(t)},s.prototype.flag=function(t){return this.flags[t]},s.prototype.setFlag=function(t,i){this.flags[t]=i},s.prototype.joinParty=function(t){this.party.push(t)},t.exports=s},function(t,i,e){function s(t,i,e){o.call(this,t,{x:i.cx,y:i.cy,sprite:e.sprite}),this.type=i.type}var o=e(0);s.prototype=Object.create(o.prototype),s.prototype.update=function(){var t=this.world.player,i=t.x-this.x,e=t.y-this.y,s=i*i+e*e;this.velocityX=0,this.velocityY=0,s<1e4&&(t.x<this.x&&(this.velocityX=-1),t.y<this.y&&(this.velocityY=-1),t.x>this.x&&(this.velocityX=1),t.y>this.y&&(this.velocityY=1)),this.step(this.velocityX,this.velocityY)},t.exports=s},function(t,i,e){function s(t,i,e,s){n.call(this,t,e),this.game=t.game,this.pages=s,this.x=e.cx,this.y=e.cy,this.eventId=i,this.refresh()}var o=e(3),n=e(0);s.prototype=Object.create(n.prototype),s.prototype.loadPage=function(t){var i=this.currentPage=t;this.inactive=!1,this.sprite=i.sprite,this.width=i.width||14,this.height=i.height||8,this.commands=i.commands,this.trigger=i.trigger||"action"},s.prototype.refresh=function(){for(var t=this.pages,i=this.pages.length-1;i>=0;i--){var e=t[i];if(!e.cond||o(e.cond,this.game.data,{}))return void this.loadPage(e)}this.inactive=!0},s.prototype.triggerEvent=function(t){t===this.trigger&&this.commands&&this.game.state.switch("cutscene",this.commands)},s.prototype.update=function(){},t.exports=s},function(t,i,e){function s(t,i,e){o.call(this,t,i),this.initQueue(e,20)}var o=e(0);s.prototype=Object.create(o.prototype),s.prototype.initQueue=function(t,i){this.followCharacter=t,this.followQueue=[],this.leaderCursor=0,this.followerCursor=1,this.followMax=i;for(var e=0;e<i;e++)this.followQueue[e]={frame:4,x:t.x,y:t.y}},s.prototype.update=function(){var t=this.followCharacter;if(this.going=!1,t.going){this.leaderCursor=(this.leaderCursor+1)%this.followMax,this.followerCursor=(this.followerCursor+1)%this.followMax;var i=this.followQueue[this.leaderCursor];i.frame=t.frame,i.x=t.x,i.y=t.y;var e=this.followQueue[this.followerCursor];this.x=e.x,this.y=e.y,this.frame=e.frame,this.going=!0}},t.exports=s},function(t,i,e){function s(t){var i={};Object.keys(t.layers).forEach(function(e){var s=t.layers[e],n=s.name;if("base64"===s.encoding&&(s.data=o.decodeAsArray(s.data,4)),"objectgroup"===s.type){switch(n){case"locations":var r={};s.objects.forEach(function(t){r[t.name]=t}),i[n]=r;break;case"spawns":case"events":i[n]=s.objects}s.objects.forEach(function(t){t.cx=t.x+t.width/2|0,t.cy=t.y+t.height/2|0})}else i[n]=s}),this.layers=i,this.width=t.width,this.height=t.height,this.tilewidth=t.tilewidth,this.tileheight=t.tileheight,this.tilesets=t.tilesets,this.mapHeight=this.height*this.tileheight,this.mapWidth=this.width*this.tilewidth}var o=e(33),n=e(34);s.prototype.get=function(t,i,e){return this.layers[t].data[i+e*this.width]},s.prototype.collide=function(t,i){return this.get("collision",t/this.tilewidth|0,i/this.tileheight|0)},s.prototype.render=function(t,i){var e=this,s=e.height,o=e.width,r=e.tileheight,h=e.tilewidth,a=e.tilesets.reverse(),c=e.mapHeight,p=e.mapWidth,u=n.create(p,c),l=u.getContext("2d");return t.forEach(function(t){for(var n=0;n<s;n++)for(var c=0;c<o;c++){var p=e.get(t,c,n),u=null,f=null,d=null;if(a.some(function(t,i){return t.firstgid<=p&&(u=t.name,f=p-t.firstgid,d=t.imagewidth/t.tilewidth,!0)},this),null!==f){var y=f%d*h,g=Math.floor(f/d)*r;l.drawImage(i[u],y,g,h,r,c*h,n*r,h,r)}}}),u},t.exports=s},function(t,i,e){function s(t,i){o.call(this,t,i)}var o=e(0);s.prototype=Object.create(o.prototype),s.prototype.update=function(){this.velocityX=0,this.velocityY=0,this.going&&(this.goalX===this.x&&this.goalY===this.y||this.blockedCount>30?this.going=!1:(this.goalX<this.x&&(this.velocityX=-1),this.goalY<this.y&&(this.velocityY=-1),this.goalX>this.x&&(this.velocityX=1),this.goalY>this.y&&(this.velocityY=1),this.step(this.velocityX,this.velocityY))),this.going&&this.prevX===this.x&&this.prevY===this.y&&this.blockedCount++,this.goalRadius>0&&(this.goalRadius-=1)},t.exports=s},function(t,i,e){function s(t){this.game=t,this.correctionWall=this.correctionWall.bind(this),this.collideEvent=this.collideEvent.bind(this),this.collideEnemy=this.collideEnemy.bind(this)}var o=e(15),n=e(13),r=e(11),h=e(2),a=e(12);s.prototype.buildParty=function(t,i){for(var e=this,s=[],r=!0,h=null,a=0;a<4;a++)r?(h=new o(e,{x:t,y:i,sprite:-1}),e.player=h,s.push(h),r=!1):(h=new n(e,{x:t,y:i,sprite:-1},h),s.push(h));return s},s.prototype.refreshParty=function(){for(var t=this.party,i=this.game.data,e=0;e<4;e++){var s=i.party[e];if(s){var o=i.members[s];t[e].sprite=o.sprite}else t[e].sprite=-1}},s.prototype.loadMap=function(t,i){var e=this,s=this.game;this.map=s.resources[t],this.mapImage=this.map.render(["layer0","layer1"],s.resources);var o=this.map.layers.locations[i];this.party=this.buildParty(o.cx,o.cy),this.refreshParty();var n=[];this.map.layers.events.forEach(function(t){var i=t.type||t.name,o=s.config.events[i];o&&n.push(new a(e,i,t,o))}),this.events=n;var h=[];this.map.layers.spawns.forEach(function(t){var i=t.type,o=s.config.enemies[i];if(o){if(t.properties&&t.properties.probability&&Math.random()>t.properties.probability/100)return;h.push(new r(e,t,o))}}),this.enemies=h,this.entities=[].concat(this.party,this.events,this.enemies),this.width=this.map.mapWidth,this.height=this.map.mapHeight},s.prototype.draw=function(t,i,e){var s=this.player,o=this.entities;t.drawImage(this.mapImage,i.x,i.y,i.width,i.height,0,0,i.width,i.height),o.sort(function(t,i){return t.y-i.y}),o.forEach(function(s){s.inactive||s.sprite>=0&&t.drawImage(e.sprites,24*s.frame,32*s.sprite,24,32,s.x-12-i.x|0,s.y-27-i.y|0,24,32)}),s.goalRadius>0&&(t.fillStyle="rgba(170, 170, 170, 0.5)",t.beginPath(),t.ellipse(s.goalX+8-i.x,s.goalY+4-i.y,s.goalRadius,s.goalRadius,0,0,2*Math.PI),t.fill(),t.closePath())},s.prototype.update=function(){var t=this,i=this.player;this.entities.forEach(function(t){t.inactive||t.update()}),this.events.forEach(function(e){e.inactive||h.collision(i,e,t.collideEvent)}),this.enemies.forEach(function(e){e.inactive||h.collision(i,e,t.collideEnemy)})},s.prototype.correctionWall=function(t,i,e,s,o,n){o>n?t.x+=(e>0?1:-1)*o:t.y+=(s>0?1:-1)*n},s.prototype.collideEvent=function(t,i,e,s,o,n){o>n?t.x+=(e>0?1:-1)*o:t.y+=(s>0?1:-1)*n,t.goalEvent===i?(t.going=!1,t.goalEvent=null,i.triggerEvent("action")):i.triggerEvent("contact")},s.prototype.collideEnemy=function(t,i,e,s,o,n){o>n?t.x+=(e>0?1:-1)*o:t.y+=(s>0?1:-1)*n,t.going=!1,t.goalEvent=null,this.game.state.switch("enterBattle")},s.prototype.refresh=function(){this.events.forEach(function(t){t.refresh()})},t.exports=s},function(t,i){function e(t){this.items=[],this.maxSize=t}e.prototype.add=function(t){this.items.length<this.maxSize&&this.items.push(t)},e.prototype.removeByPositon=function(t){this.items.splice(t,1)},e.prototype.removeById=function(t){var i=this.items.indexOf(t);return-1!==i&&(this.removeByPositon(i),!0)},e.prototype.getItems=function(){return this.items},e.prototype.contains=function(t){return-1!==this.items.indexOf(t)},e.prototype.isFull=function(){return this.items.length>=this.maxSize},t.exports=e},function(t,i){function e(t,i,e){this.game=t,this.battleState=i,this.battle=e}e.prototype.init=function(){},e.prototype.enter=function(){},e.prototype.update=function(){},e.prototype.draw=function(t,i){},t.exports=e},function(t,i,e){function s(t,i,e){this.game=t,this.battleState=i,this.battle=e}var o=e(1);s.prototype.init=function(){var t=this.game.resources.basicfont;this.menus={base:new o(t,16,16,40,20,4,[{id:"bash",text:"Bash"},{id:"psi",text:"PSI"},{id:"goods",text:"Goods"}],this.onBaseMenu.bind(this)),goods:new o(t,72,16,80,20,4,[],this.onGoodsMenu.bind(this)),psi:new o(t,72,16,80,20,4,[{id:"love",text:"Love"},{id:"freeze",text:"Freeze"},{id:"fire",text:"Fire"}],this.onPSIMenu.bind(this))}},s.prototype.setState=function(t){this.state=t;var i=this.menus;for(var e in i)Object.prototype.hasOwnProperty.call(this.menus,e)&&i[e].hide();switch(t){case"psi":i.psi.show(),i.base.show();break;case"goods":i.goods.setOptions(this.game.data.getGoodsMenu()),i.goods.show(),i.base.show();break;case"bash":this.setChoice("bash");break;case"base":i.base.show()}},s.prototype.enter=function(){this.battle.allChoosen()?(this.battle.setEnemyChoices(),this.battleState.state.switch("turn")):this.setState("base")},s.prototype.update=function(){},s.prototype.onBaseMenu=function(t){this.setState(t.id)},s.prototype.setChoice=function(t){this.battle.setChoice(t),this.battleState.state.switch("menu")},s.prototype.onGoodsMenu=function(t){this.setChoice("good:"+t)},s.prototype.onPSIMenu=function(t){this.setChoice("psi:"+t)},s.prototype.onCancel=function(){switch(this.state){case"goods":case"psi":case"bash":this.setState("base");break;case"base":this.game.state.switch("explore")}},s.prototype.draw=function(t,i){for(var e in this.menus)Object.prototype.hasOwnProperty.call(this.menus,e)&&this.menus[e].draw(t,i)},s.prototype.event=function(t,i,e){for(var s in this.menus)if(Object.prototype.hasOwnProperty.call(this.menus,s)&&this.menus[s].event(t,i,e))return;"click"===t&&this.onCancel()},t.exports=s},function(t,i){function e(t,i,e){this.game=t,this.battleState=i,this.battle=e}e.prototype.enter=function(){this.battle.startRound(),this.battleState.state.switch("menu")},t.exports=e},function(t,i){function e(t,i,e){this.game=t,this.battleState=i,this.battle=e}e.prototype.init=function(){},e.prototype.enter=function(){this.battle.turnOrder.forEach(function(t){t.hp-=2}),this.battleState.state.switch("startturn")},e.prototype.update=function(){},e.prototype.draw=function(t,i){},t.exports=e},function(t,i,e){function s(t){this.game=t,this.battle=new n(t),this.state=new o(t,{menu:new r(t,this,this.battle),startturn:new h(t,this,this.battle),turn:new a(t,this,this.battle),endturn:new c(t,this,this.battle)})}var o=e(4),n=e(7),r=e(19),h=e(20),a=e(21),c=e(18),p=e(28);s.prototype.init=function(){this.background=new p(this.game)},s.prototype.enter=function(t){this.battle.setup(t),this.state.switch("startturn")},s.prototype.update=function(){this.background.update(),this.state.update(),this.battle.tick()},s.prototype.draw=function(t,i){this.background.draw(t),this.drawEnemies(t,i),this.drawPanels(t,i),this.state.draw(t,i)},s.prototype.drawEnemies=function(t,i){t.drawImage(i.battlesprites,0,0,64,64,(this.game.ctx.canvas.width-64)/2|0,(this.game.ctx.canvas.height-64)/2|0,64,64)},s.prototype.drawPanels=function(t,i){var e=this.game.layout,s=this.battle.getPlayerCharacters(),o=s.length;s.forEach(function(s,n){var r=e.centeredEvenlySpaced(n,o,64),h=e.fromBottom(22),a=s.rollhp,c=s.name,p=s.sprite,u=s.offset;t.drawImage(i.sprites,96,32*p,24,32,r-12|0,h-u|0,24,32),t.drawImage(i.statuspanel,0,0,60,35,r-30,h,60,35);var l=i.basicfont,f=l.measureText(c);l.drawText(t,c,r-f/2,h);for(var d=Math.floor(a%1*8),y=!0,g=0;g<3;g++){var m=Math.floor(a%10),v=8*m;y&&(v+=d),a/=10,t.drawImage(i.odometer,9*v,0,8,8,r+15-8*g,h+12,8,8),y=9===m&&y}})},s.prototype.event=function(t,i,e){this.state.event(t,i,e)},t.exports=s},function(t,i,e){function s(t){this.game=t}var o=e(29),n=e(31),r=e(36),h=e(9);s.prototype.init=function(){this.dialog=new o(this.game.resources.basicfont,40,100,204,3),this.matte=new n(this.game),this.interpreter=new r(h),this.done=this.done.bind(this)},s.prototype.enter=function(t){this.dialog.reset(),this.interpreter.run(t,this,this.done)},s.prototype.update=function(){this.dialog.update(),this.matte.update()},s.prototype.draw=function(t,i){this.game.state.explore.draw(t,i),this.matte.draw(t),this.dialog.draw(t)},s.prototype.done=function(){this.game.state.switch("explore")},s.prototype.event=function(t,i,e){this.dialog.event(t,i,e)},t.exports=s},function(t,i){function e(t){this.game=t}e.prototype.enter=function(){this.radius=150},e.prototype.update=function(){if(this.radius-=4,this.radius<50){var t=this.game.state.explore.world.enemies,i=this.game.state.explore.world.player,e=[];t.forEach(function(t){var s=i.x-t.x,o=i.y-t.y;s*s+o*o<2500&&(e.push(t),t.inactive=!0)}),this.game.state.switch("battle",e)}},e.prototype.draw=function(t,i){t.save(),t.beginPath(),t.arc(this.game.getWidth()/2,this.game.getHeight()/2,this.radius,0,2*Math.PI,!1),t.clip(),this.game.state.explore.draw(t,i),t.restore()},t.exports=e},function(t,i,e){function s(t){this.game=t}var o=e(1);s.prototype.init=function(){var t=this.game.resources.basicfont;this.menus={base:new o(t,16,16,40,20,4,[{id:"goods",text:"Goods"},{id:"equip",text:"Equip"},{id:"status",text:"Status"}],this.onBaseMenu.bind(this)),goods:new o(t,72,16,80,20,4,[],this.onGoodsMenu.bind(this))}},s.prototype.setState=function(t){this.state=t;var i=this.menus;for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&i[e].hide();switch(t){case"goods":i.goods.setOptions(this.game.data.getGoodsMenu()),i.goods.show(),i.base.show();break;case"equip":case"status":case"base":i.base.show()}},s.prototype.enter=function(){this.setState("base")},s.prototype.update=function(){},s.prototype.onBaseMenu=function(t){this.setState(t.id)},s.prototype.onGoodsMenu=function(t){},s.prototype.onCancel=function(){switch(this.state){case"goods":case"equip":case"status":this.setState("base");break;case"base":this.game.state.switch("explore")}},s.prototype.draw=function(t,i){this.game.state.explore.draw(t,i);for(var e in this.menus)Object.prototype.hasOwnProperty.call(this.menus,e)&&this.menus[e].draw(t,i)},s.prototype.event=function(t,i,e){for(var s in this.menus)if(Object.prototype.hasOwnProperty.call(this.menus,s)&&this.menus[s].event(t,i,e))return;"click"===t&&this.onCancel()},t.exports=s},function(t,i,e){function s(t){this.game=t}var o=e(38),n=e(16),r=e(1),h=e(2);s.prototype.init=function(){this.viewport=new o(this.game.ctx.canvas.width,this.game.ctx.canvas.height),this.world=new n(this.game),this.world.loadMap("floor1","start");var t=this.game.resources.basicfont;this.menuButton=new r(t,250,135,29,20,4,[{id:"menu",text:"Menu"}],this.openMenu.bind(this)),this.menuButton.show()},s.prototype.update=function(){var t=this.world,i=t.player;t.update(),this.viewport.update(i,t)},s.prototype.draw=function(t,i){this.world.draw(t,this.viewport,i),this.game.state.currentState===this&&this.menuButton.draw(t)},s.prototype.onMouse=function(t,i){for(var e,s=this.viewport,o=t+s.x,n=i+s.y,r=null,a=this.world.player,c=this.world.events,p=0;p<c.length;p++)e=c[p],h.pointInRect(o,n,e.x-8,e.y-20,16,24)&&(r=e);r?(a.goalX=r.x+r.width/2-8,a.goalY=r.y+r.height/2-4,a.goalEvent=r):(a.goalX=o-8,a.goalY=n-4,a.goalEvent=null),a.goalRadius=20,a.going=!0,a.blockedCount=0},s.prototype.event=function(t,i,e){if(!this.menuButton.event(t,i,e))switch(t){case"click":case"move":this.onMouse(i,e)}},s.prototype.openMenu=function(){this.game.state.switch("exploreMenu")},s.prototype.mapTransport=function(t,i){this.world.loadMap(t,i),this.update()},s.prototype.refreshParty=function(){this.world.refreshParty()},t.exports=s},function(t,i,e){function s(t,i){var e=new Image;return i&&(e.onload=function(){i(null,e)}),e.src=t,e}function o(t){this.game=t}var n=e(8),r=e(14),h=e(6);o.prototype.enter=function(){function t(){++e>=o&&i.game.state.switch("explore")}var i=this,e=0,o=8,a={sprites:s("./images/sprites.png",t),basicfontsheet:s("./fonts/basic.png",t),pattern:s("./images/pattern.png",t),floor1:new r(h),layer0:s("./images/layer0.png",t),layer1:s("./images/layer1.png",t),odometer:s("./images/odometer.png",t),statuspanel:s("./images/status-panel.png",t),battlesprites:s("./images/battle-sprites.png",t)};a.basicfont=new n(BasicFontMeta,a.basicfontsheet),this.game.resources=a},o.prototype.update=function(){},o.prototype.draw=function(t,i){},t.exports=o},function(t,i){function e(t){this.game=t,this.x=0,this.y=Math.floor(t.getHeight()/4),this.width=Math.floor(t.getWidth()),this.height=Math.floor(t.getHeight()/2),this.pattern=t.resources.pattern,this.visible=!0,this.t=0}e.prototype.update=function(){this.visible&&this.t++},e.prototype.draw=function(t){if(this.visible){var i=this.pattern;this.drawLayer(t,{pattern:i,A:30,F:.03,S:.04}),t.globalAlpha=.5,this.drawLayer(t,{pattern:i,A:20,F:.02,S:.07}),t.globalAlpha=1}},e.prototype.drawLayer=function(t,i){for(var e=this.t,s=this.width,o=this.height,n=this.x,r=this.y,h=i.A,a=i.F,c=i.S,p=i.pattern,u=p.height,l=0;l<o;l++){var f=h*Math.sin(a*l+c*e);t.drawImage(p,Math.floor((f+160)%s),l%u,s,1,n,r+l,s,1)}},t.exports=e},function(t,i){function e(t,i,e,s,o){this.x=i,this.y=e,this.width=s,this.lineCount=o,this.lineHeight=16,this.font=t,this.visible=!1,this.reset(),this.callback=null}e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e.prototype.showText=function(t,i){this.buffer+=t,this.finished=!1,this.callback=i,this.show()},e.prototype.update=function(){this.visible&&++this.tick%3==0&&this.onTick()},e.prototype.onTick=function(){this.lines.length&&this.lines[this.cursorLine].length>this.cursorPos?this.cursorPos++:this.buffer.length>0?(this.lines.length===this.lineCount&&this.lines.shift(),this.lines.push(this.getNextLine()),this.cursorLine=this.lines.length-1,this.cursorPos=0):this.finished||(this.finished=!0)},e.prototype.getNextLine=function(){for(var t,i="",e=this.buffer.split(" "),s=!1,o=0,n=this.font;!s&&e[o];)t=n.measureText(i+e[o]+" "),t>this.width?s=!0:(i+=e[o]+" ",o++);return this.buffer=this.buffer.substr(i.length),i},e.prototype.draw=function(t){if(this.visible){var i,e,s=this.font,o=this.width,n=this.lineCount,r=this.lineHeight,h=this.x,a=this.y,c=this.lines,p=this.cursorLine,u=this.cursorPos;for(t.fillStyle="black",t.fillRect(this.x-8,this.y-8,o+16,n*r+16),e=0;e<c.length;e++)i=c[e],p===e&&(i=i.substr(0,u)),s.drawText(t,i,h,a),a+=r;if(this.finished){var l=this.y+n*r+Math.floor(this.tick/10)%3,f=this.x+o/2;t.fillStyle="white",t.beginPath(),t.moveTo(f-5,l),t.lineTo(f+5,l),t.lineTo(f,l+5),t.fill()}}},e.prototype.reset=function(){this.hide(),this.buffer="",this.lines=[],this.cursorLine=0,this.cursorPos=0,this.tick=0},e.prototype.flush=function(){for(;this.buffer.length>0;)this.lines.length===this.lineCount&&this.lines.shift(),this.lines.push(this.getNextLine()),this.cursorLine=this.lines.length-1,this.cursorPos=this.lines[this.cursorLine].length;this.finished=!0},e.prototype.action=function(){this.finished?this.done():this.flush()},e.prototype.event=function(t){this.visible&&"click"===t&&this.action()},e.prototype.done=function(){if(this.callback){var t=this.callback;this.callback=null,t()}},t.exports=e},function(t,i){function e(t){this.game=t}e.prototype.fromBottom=function(t){return this.game.getHeight()-t},e.prototype.centeredEvenlySpaced=function(t,i,e){var s=(i-1)*e,o=-s/2+t*e;return this.game.getWidth()/2+o},t.exports=e},function(t,i,e){function s(t){this.game=t,this.color={r:0,b:0,g:0},this.width=t.getWidth(),this.height=t.getHeight(),this.visible=!1,this.alpha=0,this.tween=new o}var o=e(37);s.prototype.fadeIn=function(t,i){var e=this;this.tween.start(this,"alpha","linear",1,0,t,function(){e.visible=!1,i()})},s.prototype.fadeOut=function(t,i){this.visible=!0,this.tween.start(this,"alpha","linear",0,1,t,i)},s.prototype.update=function(){this.visible&&this.tween.update()},s.prototype.draw=function(t){if(this.visible){var i=this.color,e=this.alpha;t.fillStyle="rgba("+i.r+", "+i.g+", "+i.b+", "+e+")",t.fillRect(0,0,this.width,this.height)}},t.exports=s},function(t,i){function e(t){this.animations=t,this.currentAnimation=Object.keys(t)[0],this.position=0,this.timer=0,this.playing=!1}e.prototype.update=function(){var t=this.animations[this.currentAnimation],i=t.delay,e=t.frames,s=t.loop,o=t.after;++this.timer>i&&(this.timer-=i,++this.position>=e.length&&(o&&o(),this.position=0,s||(this.playing=!1)))},e.prototype.play=function(t){this.animations[t]&&(this.currentAnimation=t,this.reset())},e.prototype.stop=function(){this.playing=!1},e.prototype.reset=function(){this.playing=!0,this.position=0,this.timer=0},e.prototype.getCurrentAnimation=function(){return this.currentAnimation},e.prototype.getCurrentFrame=function(){return this.animations[this.currentAnimation].frames[this.position]},t.exports=e},function(t,i){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s={decode:function(t){var i,s,o,n,r,h,a,c=[],p=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<t.length;)n=e.indexOf(t.charAt(p++)),r=e.indexOf(t.charAt(p++)),h=e.indexOf(t.charAt(p++)),a=e.indexOf(t.charAt(p++)),i=n<<2|r>>4,s=(15&r)<<4|h>>2,o=(3&h)<<6|a,c.push(String.fromCharCode(i)),64!==h&&c.push(String.fromCharCode(s)),64!==a&&c.push(String.fromCharCode(o));return c=c.join("")},decodeAsArray:function(t,i){i=i||1;var e,o,n=s.decode(t),r=n.length/i,h=[];for(e=0;e<r;e++)for(h[e]=0,o=i-1;o>=0;--o)h[e]+=n.charCodeAt(e*i+o)<<(o<<3);return h}};t.exports=s},function(t,i){var e={create:function(t,i){var e=document.createElement("canvas");return e.width=t,e.height=i,e}};t.exports=e},function(t,i){function e(t,i,e){return Math.max(Math.min(t,e),i)}function s(t,i,s){return t+e(i-t,-s,s)}t.exports={clamp:e,transition:s}},function(t,i,e){function s(t){this.commands=t}var o=e(3);s.prototype.run=function(t,i,e){this.ip=0,this.lines=t,this.done=e,this.context=i,this.inc=this.inc.bind(this),this.next()},s.prototype.next=function(){this.ip<this.lines.length?this.exec(this.lines[this.ip]):this.done()},s.prototype.inc=function(t){t?this.done(t):(this.ip++,this.next())},s.prototype.jump=function(t){do{this.ip++}while(this.ip<this.lines.length&&-1===t.indexOf(this.lines[this.ip].cmd))},s.prototype.keywords={if:function(t){o(t.cond,this.context.game.data,{})?this.inc():(this.jump(["else","endif"]),this.inc())},else:function(t){this.jump(["endif"]),this.inc()},endif:function(t){this.inc()}},s.prototype.exec=function(t){var i=this.keywords[t.cmd];i?i.call(this,t):this.commands[t.cmd](this.context,t,this.inc)},t.exports=s},function(t,i){function e(){this.playing=!1,this.s=0,this.e=0,this.x=0,this.frames=0,this.target=null,this.prop=null,this.done=null}var s={linear:function(t){return t},smoothstep:function(t){return t*t*(3-2*t)},smoothstepSquared:function(t){return Math.pow(t*t*(3-2*t),2)},smoothstepCubed:function(t){return Math.pow(t*t*(3-2*t),3)},acceleration:function(t){return t*t},accelerationCubed:function(t){return Math.pow(t*t,3)},deceleration:function(t){return 1-Math.pow(1-t,2)},decelerationCubed:function(t){return 1-Math.pow(1-t,3)},sine:function(t){return Math.sin(t*Math.PI/2)},sineSquared:function(t){return Math.pow(Math.sin(t*Math.PI/2),2)},sineCubed:function(t){return Math.pow(Math.sin(t*Math.PI/2),2)},inverseSine:function(t){return 1-Math.sin((1-t)*Math.PI/2)},inverseSineSquared:function(t){return 1-Math.pow(Math.sin((1-t)*Math.PI/2),2)},inverseSineCubed:function(t){return 1-Math.pow(Math.sin((1-t)*Math.PI/2),3)}};e.prototype.start=function(t,i,e,o,n,r,h){this.target=t,this.prop=i,this.ease=s[e],this.s=o,this.e=n,this.x=0,this.frames=r,this.done=h,this.playing=!0},e.prototype.update=function(){if(this.playing&&this.target)if(this.x<this.frames){var t=this.x/this.frames,i=this.ease(t);this.target[this.prop]=this.e*i+this.s*(1-i),this.x++}else if(this.playing=!1,this.done){var e=this.done;this.done=null,e()}},t.exports=e},function(t,i){function e(t,i,e,s){this.width=t,this.height=i,this.x=e||0,this.y=s||0}e.prototype.update=function(t,i){this.x=t.x-this.width/2,this.y=t.y-this.height/2},t.exports=e},function(t,i,e){t.exports=e(5)}]);
//# sourceMappingURL=app.js.map